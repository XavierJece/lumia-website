---
description: 'Frontend testing standards for React/NextJS institutional and e-commerce site'
globs: ['test/**/*.ts', 'test/**/*.tsx']
alwaysApply: false
---

# Testing Standards & Requirements

## Test Structure & Organization

### File Locations

- **All tests** must be placed in the `/test` directory
- **Never** place test files alongside source code in `/src`
- **Unit tests**: `/test/unit/` for isolated component/logic tests
- **Integration tests**: `/test/integration/` for tests involving external resources

### Naming Conventions

- Use `.test.ts` extension for all test files (not `.spec.ts`)
- Test files should match source filename: `Button.tsx` â†’ `Button.test.ts`
- Integration tests: `checkout.integration.test.ts`

## Testing Approach

### Core Principles

1. **Test Independence**: Each test must run independently with no dependencies on other tests
2. **Single Responsibility**: Focus on testing one behavior per test case
3. **Repeatability**: Tests must produce identical results on every run
4. **AAA Pattern**: Follow Arrange-Act-Assert structure for all tests

### Testing Levels

- **Unit Tests** (in `/test/unit/`):

  - Test individual components, hooks, and utilities
  - Mock all external dependencies (APIs, browser APIs, context)
  - Use Sinon for stubs, spies, and mocks
  - Test all possible states and edge cases

- **Integration Tests** (in `/test/integration/`):
  - Test component interactions and data flow
  - Mock only external APIs (HTTP requests, third-party services)
  - Test user flows and critical paths

### Frontend-Specific Guidelines

- **Component Testing**:

  - Test rendered output, user interactions, and state changes
  - Mock NextJS router and API routes
  - Use testing-library patterns over enzyme

- **Hook Testing**:

  - Test custom hooks in isolation
  - Mock browser APIs (localStorage, window properties)

- **API Route Testing** (NextJS):
  - Test API handlers as integration tests
  - Mock external services but test request/response flow
  - Test error responses and status codes

## Technical Implementation

### Required Libraries

- **Jest**: Primary testing framework
- **Sinon**: For test doubles (stubs, spies, mocks)
- **Testing Library**: For React component testing

### Test Commands

- Run all tests: `pnpm test`
- Run unit tests only: `pnpm test:unit`
- Run integration tests only: `pnpm test:integration`
- Generate coverage: `pnpm test:coverage`

### Mocking Strategy

1. **Date/Time**: Always mock `Date` objects for time-dependent tests
2. **External APIs**: Stub all HTTP requests in unit tests
3. **Browser APIs**: Mock localStorage, sessionStorage, window properties
4. **NextJS Features**: Mock router, image optimization, and dynamic imports

### Setup & Teardown

- Use `beforeEach` for common test setup
- Always clean up mocks after each test (`sinon.restore()`)
- Reset DOM after component tests
- Clear all mocks between tests

## Coverage Requirements

### Minimum Coverage

- **Overall**: 80% line coverage
- **Critical paths**: 100% line coverage
  - Authentication flows
  - Checkout and payment processes
  - User data handling
  - Form submissions and validation

### Coverage Enforcement

- Failing tests block CI/CD pipeline
- Coverage reports generated on every test run
- Critical path coverage verified in PR reviews

## Quality Standards

### Test Quality

- Each test must have clear, descriptive names
- Avoid testing implementation details; focus on behavior
- Use meaningful assertions with descriptive error messages
- Ensure tests fail for the right reasons

### Performance

- Unit tests: < 100ms per test
- Integration tests: < 500ms per test
- No shared state between tests
- Mock expensive operations (API calls, file I/O)

### Maintenance

- Update tests when source code changes
- Remove or update flaky tests immediately
- Document why specific mocks are needed
- Group related tests with `describe` blocks
